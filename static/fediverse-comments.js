"use strict";(()=>{var _=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var H=(t,e)=>{var o={};for(var n in t)V.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&_)for(var n of _(t))e.indexOf(n)<0&&J.call(t,n)&&(o[n]=t[n]);return o};var h=t=>{var r;let{host:e,pathname:o}=new URL(t),n=(r=o.split("/")[2])!=null?r:"";return{host:e,status:n}};var C=async(...t)=>{let e=await fetch(...t);if(!e.ok)throw new Error(e.statusText);return await e.json()},K=({host:t,status:e})=>C("https://".concat(t,"/api/v1/statuses/").concat(e,"/context?limit=1"),{}),G=t=>K(t).then(e=>e.descendants),W=async({host:t,status:e})=>C("https://".concat(t,"/api/v1/statuses/").concat(e,", {});")),D=async({host:t,status:e})=>C("https://".concat(t,"/api/v1/statuses/").concat(e,"/reblogged_by"),{}),I=async({host:t,status:e})=>C("https://".concat(t,"/api/v1/statuses/").concat(e,"/favourited_by"),{}),N=async t=>{let e=typeof t=="string"?h(t):t,[o,n]=await Promise.all([W(e),G(e)]);return{original:o,replies:n}};var g=()=>(t,s={})=>{var l=s,{attributes:e={},classes:o=[],children:n=[]}=l,r=H(l,["attributes","classes","children"]);let a=document.createElement(t);Object.entries(e).forEach(([i,p])=>a.setAttribute(i,p)),o.forEach(i=>a.classList.add(i));for(let i of["id","textContent"]){let p=r[i];p!=null&&(a[i]=p)}let{innerHTML:u}=r;if(u)try{let i=new Sanitizer;a.setHTML(u,{sanitizer:i}),console.log("sanitized",u)}catch(i){a.innerHTML=u}return n.forEach(i=>a.appendChild(i)),a};var x=g(),E=(t,e)=>{let o=t;return e.forEach(n=>{let r=x("source",{attributes:{srcset:n.url,media:"(prefers-reduced-motion: no-preference)"}}),s=x("img",{classes:["emoji"],attributes:{src:n.static_url,alt:":".concat(n.shortcode,":"),title:":".concat(n.shortcode,":")}}),l=x("picture",{classes:["emoji"],children:[r,s]});o=o.replace(":".concat(n.shortcode,":"),l.outerHTML)}),o};var S=(t,e)=>{let o=Date.now()-t.getTime(),n=(a,u)=>{e(a,t),u!=null&&u>0&&setTimeout(()=>S(t,e),u)},r=6e4,s=60*r,l=24*s;if(o<r)n("seconds ago",r-o);else if(o<s){let a=Math.floor(o/r);n("".concat(a," minute").concat(a>1?"s":""," ago"),r-o%r)}else if(o<l){let a=Math.floor(o/s);n("".concat(a," hour").concat(a>1?"s":""," ago"),s-o%s)}else if(o<14*l){let a=Math.floor(o/l);n("".concat(a," day").concat(a>1?"s":""," ago"),l-o%l)}else n(t.toLocaleString("en-US",{dateStyle:"long",timeStyle:"short"}))};var c=g(),k=(t,e)=>{var r;let o=[],n=new Map;for(let s of t){let l=s.account.id===e.id,a=new URL(s.account.url).hostname,u=c("source",{attributes:{srcset:s.account.avatar,media:"(prefers-reduced-motion: no-preference)"}}),i=c("img",{classes:["comment-authors-avatar"],attributes:{src:s.account.avatar_static,alt:"@".concat(s.account.username,"@").concat(a," avatar")}}),p=c("picture",{classes:["comment-authors-avatar"],children:[u,i]}),d=c("a",{classes:["comment-authors-avatar-link"],attributes:{href:s.account.url,rel:"external nofollow",title:"view profile at @".concat(s.account.username,"@").concat(a)},children:[p]}),f=c("span",{classes:["at-symbol","username-at-symbol"],textContent:"@"}),T=c("span",{classes:["at-symbol","server-at-symbol"],textContent:"@"}),y=c("span",{classes:["comment-authors-fediverse-username"],textContent:s.account.username}),v=c("span",{classes:["comment-authors-fediverse-server"],textContent:a}),L=c("span",{classes:["comment-authors-display-name"],innerHTML:E(s.account.display_name,s.account.emojis),attributes:{itemprop:"author",itemtype:"http://schema.org/Person"}}),b=c("a",{classes:["comment-authors-fediverse-identity"],attributes:{href:s.account.url,title:"@".concat(s.account.username,"@").concat(a),rel:"external nofollow"},children:[f,y,T,v]}),m=c("div",{classes:["comment-author"],children:[L,b]}),j=c("header",{classes:["comment-header",...l?["original-poster"]:[]],children:[d,m]}),F=c("a",{classes:["comment-link-to-original"],textContent:"original post",attributes:{href:(r=s.url)!=null?r:"",itemprop:"url",title:"view at ".concat(a),rel:"external nofollow"}}),O=c("main",{classes:["comment-content"],innerHTML:E(s.content,s.emojis),attributes:{itemprop:"text"}}),$=c("time",{classes:["comment-time"],attributes:{dateTime:s.created_at},textContent:new Date(s.created_at).toLocaleString("en-US",{dateStyle:"long",timeStyle:"short"})});S(new Date(s.created_at),B=>{$.textContent=B});let z=c("span",{classes:["comment-counters"],children:[...s.reblogs_count>0?[c("a",{classes:["comment-counter-reblogs"],textContent:"".concat(s.reblogs_count),attributes:{href:"".concat(s.url,"/reblogs"),title:"Reblogs reported by ".concat(a)}})]:[],...s.favourites_count>0?[c("a",{classes:["comment-counter-favourites"],textContent:"".concat(s.favourites_count),attributes:{href:"".concat(s.url,"/favourites"),title:"favourites reported by ".concat(a)}})]:[]]}),q=c("footer",{classes:["comment-footer",...l?["original-poster"]:[]],children:[z,F,$]}),w=c("div",{classes:["comment-replies"]});n.set(s.id,w);let M=c("article",{id:"comment-".concat(s.id),classes:["fediverse-comment"],attributes:{itemprop:"comment",itemtype:"http://schema.org/Comment"},children:[j,O,q,w]}),R=s.in_reply_to_id!=null?n.get(s.in_reply_to_id):void 0;R?R.appendChild(M):o.push(M)}return o};var X=async t=>{var y,v,L,b;let e=(y=t==null?void 0:t.dataset)!=null?y:{},o=e.hideRootComment!=null&&e.hideRootComment!=="false",n=new Set(((v=e.include)!=null?v:"").split(",").map(m=>m.trim())),r=new Set(((L=e.exclude)!=null?L:"").split(",").map(m=>m.trim().toLocaleLowerCase())),s=parseInt((b=e.max)!=null?b:""),l=e.responsesToUrl,{host:a,status:u}=l!=null?h(l):e;if(a==null||u==null)return;let{original:i,replies:p}=await N({host:a,status:u}),d=[...o?[]:[i],...p.filter(m=>r.has(m.id.toLocaleLowerCase())||r.has(m.account.username.toLocaleLowerCase())||r.has(m.account.id.toLocaleLowerCase())?!1:m.in_reply_to_id!=null&&r.has(m.in_reply_to_id)?(r.add(m.id.toLocaleLowerCase()),!1):!0)];if(!isNaN(s))for(var f=d.length-1;f>0&&d.length>s;f--){let m=d[f];n.has(m.id.toLocaleLowerCase())||r.has(m.account.username.toLocaleLowerCase())||r.has(m.account.id.toLocaleLowerCase())||d.splice(f,1)}k(d,i.account).forEach(m=>t.appendChild(m))},U=()=>{let t=document.querySelectorAll("[data-host][data-status], [data-responses-to-url]");for(let e of t)e instanceof HTMLElement&&X(e)};var A=g(),Y=t=>{let e=new URL(t.url).hostname,o=A("source",{attributes:{srcset:t.avatar,media:"(prefers-reduced-motion: no-preference)"}}),n=A("img",{classes:["fediverse-account-avatar"],attributes:{src:t.avatar_static,alt:"".concat(t.display_name," (@").concat(t.username,"@").concat(e,") avatar")}}),r=A("picture",{classes:["fediverse-account-avatar"],children:[o,n]});return A("a",{classes:["fediverse-account-avatar-link"],attributes:{href:t.url,rel:"external nofollow",title:"".concat(t.display_name," (@").concat(t.username,"@").concat(e,")")},children:[r]})};var Q=async(t,e,o)=>{var i,p;let n=(i=o==null?void 0:o.dataset)!=null?i:{},r=new Set(((p=n.exclude)!=null?p:"").split(",").map(d=>d.trim().toLocaleLowerCase())),s=h(e),{host:l,status:a}=s;if(l==null||a==null)return;(await(t==="reblogged"?D(s):I(s))).filter(d=>!r.has(d.id.toLocaleLowerCase())||r.has(d.username.toLocaleLowerCase())).map(Y).forEach(d=>o.appendChild(d))},P=()=>{let t=document.querySelectorAll("[data-reblogged-url]");for(let o of t)if(o instanceof HTMLElement){let n=o.dataset.rebloggedUrl;n!=null&&Q("reblogged",n,o)}let e=document.querySelectorAll("[data-favourited-url]");for(let o of e)if(o instanceof HTMLElement){let n=o.dataset.favouritedUrl;n!=null&&Q("favourited",n,o)}};document.addEventListener("DOMContentLoaded",()=>{U(),P()});})();
//# sourceMappingURL=fediverse-comments.js.map
