"use strict";(()=>{var M=["host","status","statusUrl","include","exclude","max","hideRootStatus","display"],D=async(...t)=>{let e=await fetch(...t);if(!e.ok)throw new Error(e.statusText);return await e.json()},N=({host:t,status:e})=>D("https://".concat(t,"/api/v1/statuses/").concat(e,"/context?limit=1"),{}),q=async({host:t,status:e})=>D("https://".concat(t,"/api/v1/statuses/").concat(e,", {});")),H=t=>{var i;let{host:e,pathname:s}=new URL(t),l=(i=s.split("/")[2])!=null?i:"";return{host:e,status:l}},$=async t=>{let e=typeof t=="string"?H(t):t,[s,l]=await Promise.all([q(e),N(e)]);return[s,...l.descendants]},U=(t,e)=>{for(var s;s==null&&t instanceof Element;){if(t instanceof HTMLElement&&(s=t.dataset[e],s!=null))return s;t=t.parentElement}},Q=t=>U(t,"responseUrl"),J=t=>U(t,"rootCommentUrl"),I=async t=>{var R,b,v,C,w,L;let e=(R=t==null?void 0:t.dataset)!=null?R:{},s=new Set(((b=e.include)!=null?b:"").split(",").map(n=>n.trim())),l=new Set(((v=e.exclude)!=null?v:"").split(",").map(n=>n.trim())),i=parseInt((C=e.max)!=null?C:""),S=e.statusUrl,{host:g,status:f}=S!=null?H(S):e;if(g==null||f==null)return;let u=(await $({host:g,status:f})).filter(n=>!l.has(n.id));if(!isNaN(i))for(var d=u.length-1;d>0&&u.length>i;d--)s.has(u[d].id)||u.splice(d,1);let x=new Map,A=t.cloneNode(!0);for(let n of M)delete A.dataset[n];for(let n of u){let a=f===n.id?t:A.cloneNode(!0),o=a.querySelector("[data-response-type=author], .response-author"),p=a.querySelector("[data-response-type=author-name], .response-author-name"),c=a.querySelector("[data-response-type=author-handle], .response-author-handle"),h=a.querySelector("[data-response-type=content], .response-content"),y=a.querySelector("[data-response-type=replies], .response-replies");if(!o&&(!p||!c)||!h||!y)return;let{account:T}=n,{hostname:_}=new URL(T.url),r=document.createElement("a");r.classList.add("fediverse-handle-name"),r.setAttribute("href",T.url),r.setAttribute("target","_blank"),r.textContent="@".concat(T.username);let m=document.createElement("span");m.classList.add("fediverse-host-name"),m.textContent="@".concat(_),p?p.textContent=n.account.display_name:o&&(o.textContent="".concat(n.account.display_name," ")),c?(c.appendChild(r),c.appendChild(m)):o&&(o.appendChild(r),o.appendChild(m)),h.innerHTML=n.content;for(let E of[o,p,c,h,y,a])E!=null&&(E.setAttribute("data-response-id",n.id),E.setAttribute("data-response-url",(w=n.url)!=null?w:""));x.set(n.id,y),a!==t&&n.in_reply_to_id&&((L=x.get(n.in_reply_to_id))==null||L.appendChild(a))}},P=()=>{let t=document.querySelectorAll("[data-host][data-status], [data-status-url]");for(let e of t)e instanceof HTMLElement&&I(e)};document.addEventListener("DOMContentLoaded",P);})();
//# sourceMappingURL=fedicomments.js.map
